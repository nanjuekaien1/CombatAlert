
YellAirphaseDem		= "Rikk zilthuras rikk zila Aman adare tiriosh ",--Demonic, since curse of tonges is used by some guilds and it messes up yell detection.
	YellPhase2Dem		= "Zar kiel xi romathIs zilthuras revos ruk toralar ",--Demonic, since curse of tonges is used by some guilds and it messes up yell detection.


-----------------------------------
-- 離開和進入戰鬥,大文字提示
local _, ns = ...
--如需要显示中文，请注意文件编码格式UTF-8
ns.setting = {
	EnableCombat = true,		--开启进入/脱离战斗提示
	--EnableHealth = false,		--开启低血量报警提示
	--EnableInterrupt = false,		--开启打断提示
	--EnableExecute = false,		--开启斩杀提示
	--OnlyShowBoss = false,		--仅显示Boss的斩杀提示
	--AutoThreshold = false,		--根据职业自动判断斩杀阶段
	--EnableSpellImmune = false,		--开启法术免疫提示
	--ExecuteThreshold = 0.2,		--斩杀阶段血量
}

ns.texts = {
	EnterCombat = {
		"进  入  戦  斗！",
		--"戦斗开始！！",
		--"看你不爽,兄弟一起上！",
		--"有刺客,快护驾!朕重重有赏!!",
		},
	LeaveCombat = {
		"脱  离  戦  斗！",
		"十步杀一人，千里不留行！",
		--"事了拂衣去，深藏身与名！！",
		--"拭去手上鲜血，转身离去。。",
		},
	--[[ExecutePhase = {
		"!!斩   殺!!",
		--"爆发吧!小宇宙!!",
		},
	Hplow = {
		"血 量 过 低！!",
		--"注意！还玩没命了！",
		"血量低于35%",
		},
	Mplow = {
		"法力过低！",
		"动力不足",
		"魔法值低于35%",
		},]]
}

--[[ns.class = {
	["WARRIOR"] = { 0.2, 0.2, 0.2}, --每个职业每个天赋的斩杀阶段血量，统计可能不准确，0即为不显示，3个数字依次是3系天赋
	["DRUID"] = { 0, 0.25, 0.25},
	["PALADIN"] = { 0, 0, 0.2},
	["PRIEST"] = { 0, 0, 0.20},
	["DEATHKNIGHT"] = { 0, 0.35, 0},
	["WARLOCK"] = { 0.25, 0.25, 0.20},
	["ROGUE"] = { 0.35, 0, 0},
	["HUNTER"] = { 0.2, 0.2, 0.2},
	["MAGE"] = { 0, 0.35, 0},
	["SHAMAN"] = { 0, 0, 0},
	["MONK"] = { 0, 0, 0},
}]]

local MyAddon = CreateFrame("Frame")
local imsg = CreateFrame("Frame", "CombatAlert")
imsg:SetSize(420, 70)
imsg:SetPoint("TOP", 0, -210)
imsg:Hide()
imsg.bg = imsg:CreateTexture(nil, 'BACKGROUND')
imsg.bg:SetTexture([[Interface\LevelUp\LevelUpTex]])
imsg.bg:SetPoint('BOTTOM')
imsg.bg:SetSize(326, 103)
imsg.bg:SetTexCoord(0.00195313, 0.63867188, 0.03710938, 0.23828125)
imsg.bg:SetVertexColor(1, 1, 1, 0.5)

imsg.lineTop = imsg:CreateTexture(nil, 'BACKGROUND')
imsg.lineTop:SetDrawLayer('BACKGROUND', 2)
imsg.lineTop:SetTexture([[Interface\LevelUp\LevelUpTex]])
imsg.lineTop:SetPoint("TOP")
imsg.lineTop:SetSize(420, 7)
imsg.lineTop:SetTexCoord(0.00195313, 0.81835938, 0.01953125, 0.03320313)

imsg.lineBottom = imsg:CreateTexture(nil, 'BACKGROUND')
imsg.lineBottom:SetDrawLayer('BACKGROUND', 2)
imsg.lineBottom:SetTexture([[Interface\LevelUp\LevelUpTex]])
imsg.lineBottom:SetPoint("BOTTOM")
imsg.lineBottom:SetSize(420, 7)
imsg.lineBottom:SetTexCoord(0.00195313, 0.81835938, 0.01953125, 0.03320313)

imsg.text = imsg:CreateFontString(nil, 'ARTWORK', 'GameFont_Gigantic')
imsg.text:SetPoint("BOTTOM", 0, 15)
imsg.text:SetTextColor(1, 0.82, 0)
imsg.text:SetJustifyH("CENTER")
imsg.text:SetFont("fonts\\ARKai_T.TTF", 45, "OUTLINE") -- 字体设置
CombatAlert:SetScale(0.9)

local flag = 0
ExecuteThreshold =  ns.setting.ExecuteThreshold
local function ShowAlert(texts)
	CombatAlert.text:SetText(texts[math.random(1,table.getn(texts))])
	CombatAlert:Show()
end

--local function ShowInterruptAlert(texts,name)
	--CombatAlert.text:SetText("打断—"..texts)
	--CombatAlert:Show()
--end

if ns.setting.EnableCombat then
	MyAddon:RegisterEvent("PLAYER_REGEN_ENABLED")
	MyAddon:RegisterEvent("PLAYER_REGEN_DISABLED")
end

--[[if ns.setting.EnableHealth then
	MyAddon:RegisterEvent("UNIT_HEALTH")
end]]--

--[[if ns.setting.EnableExecute then
	MyAddon:RegisterEvent("UNIT_HEALTH")
	MyAddon:RegisterEvent("PLAYER_TARGET_CHANGED")
end]]
--[[if ns.setting.AutoThreshold then
	MyAddon:RegisterEvent("PLAYER_ENTERING_WORLD")
end
if  ns.setting.EnableSpellImmune then                 ---ns.setting.EnableInterrupt or
	MyAddon:RegisterEvent("COMBAT_LOG_EVENT_UNFILTERED")
end]]

MyAddon:SetScript("OnEvent", function(self, event, _, subevent, _, _, sourceName, _, _, _, destName, _, _, _, _, _, spellID, spellName)
	if event == "PLAYER_REGEN_DISABLED" then
		ShowAlert(ns.texts.EnterCombat)
		flag = 0
	elseif event == "PLAYER_REGEN_ENABLED" then
		ShowAlert(ns.texts.LeaveCombat)
		flag = 0
	--[[elseif event == "PLAYER_TARGET_CHANGED" then
		flag = 0
	elseif event == "UNIT_HEALTH" then
		if (UnitName("player") and (UnitHealth("player") / UnitHealthMax("player") < 0.40 and not UnitIsDead("player") and flag == 0 )) then
			ShowAlert(ns.texts.Hplow)
			flag = 1
		elseif (UnitName("target") and UnitCanAttack("player", "target") and not UnitIsDead("target") and ( UnitHealth("target")/UnitHealthMax("target") < ExecuteThreshold ) and flag == 0 ) then
			if ((ns.setting.OnlyShowBoss and UnitLevel("target")==-1) or ( not ns.setting.OnlyShowBoss)) then
				ShowAlert(ns.texts.ExecutePhase)
				flag = 
			end
		end

	elseif event == "COMBAT_LOG_EVENT_UNFILTERED"  and (sourceName == UnitName("player") or sourceName == UnitName("pet")) then   --and subevent=="SPELL_INTERRUPT"
		--ShowInterruptAlert(spellName,destName)]]
	end
end)

local timer = 0
imsg:SetScript("OnShow", function(self)
	timer = 0
	self:SetScript("OnUpdate", function(self, elasped)
		timer = timer + elasped
		if (timer<0.5) then self:SetAlpha(timer*2) end
		if (timer>1 and timer<2) then self:SetAlpha(1-(timer-1)*2) end
		if (timer>=2 ) then self:Hide() end
	end)
end)
-------------------------------------

-- 免疫/打斷提示
-------------------------------------
--[[local frame = CreateFrame("Frame", nil, UIParent)
frame:RegisterEvent('COMBAT_LOG_EVENT_UNFILTERED')
frame:SetScript("OnEvent", function(self, event, ...)
	local _, subevent, _, _, sourceName, sourceFlag, _, _, destName, _, _, _, spellName, _, extraSpellID = CombatLogGetCurrentEventInfo()
	if (subevent == 'SPELL_INTERRUPT') then
		if (bit.band(sourceFlag, COMBATLOG_OBJECT_AFFILIATION_MINE) == 0) then return end
		if (not sourceName) then return end
		local msg = format("%s -%s- %s", sourceName or "", INTERRUPT, GetSpellLink(extraSpellID))
		if (IsInGroup(LE_PARTY_CATEGORY_INSTANCE)) then
			SendChatMessage(msg, "INSTANCE_CHAT")
		elseif (IsInRaid()) then
			SendChatMessage(msg, "RAID")
		elseif (IsInGroup()) then
			SendChatMessage(msg, "PARTY")
		end
	elseif subevent == 'SPELL_MISSED' and extraSpellID == 'IMMUNE' then
		ShowAlert({destName .. '免疫了' .. spellName})
	end
end)
]]--

--------------------
--声望显示
--声望显示格式修改为：某声望名(现在声望值/总体）：（+本次增加）
--早期代码来自于NGA-有狐夜泣;中期代码来自NGA-高频变压器;后期感谢NGA-siweia 帮忙修改显示巅峰等级
--------------------
--[[local SR_REP_MSG = "%s(%d/%d)：%+d声望";
local SR_REP_MSG2 = "%s(%d/巅峰%d)：%+d声望";  
local SR_REP_MSG3 = "%s(%d/巅峰%d)：%+d声望，已满请兑换！"; 
local rep = {};
local extraRep = {};
local C_Reputation_IsFactionParagon = C_Reputation.IsFactionParagon
local function SR_Update()
	local numFactions = GetNumFactions(self);
	for i = 1, numFactions, 1 do
		local name, _, standingID, barMin, barMax, barValue, atWarWith, canToggleAtWar, isHeader, isCollapsed, hasRep, isWatched, isChild, factionID = GetFactionInfo(i);
		local value = 0;
		if barValue >= 41000 then
    		local hasParagon = C_Reputation_IsFactionParagon(factionID)
    		if hasParagon then
        		initExtraRep(factionID,name)
        		local currentValue, threshold, _, hasRewardPending = C_Reputation.GetFactionParagonInfo(factionID)
				local pIndex = floor(currentValue/threshold) --新加可以显示巅峰等级
        		value = currentValue % threshold
        		if hasRewardPending then 
        			value = value + threshold
        		end
        		local extraChange = value - extraRep[name];
        		if extraChange > 0 and value < 10000 then
        			extraRep[name] = value
        			local extra_msg = string.format(SR_REP_MSG2, name, value, pIndex, extraChange) --新加可以显示巅峰等级
        			createMessage(extra_msg);
        		end
        		if extraChange ~= 0 and value > 10000 then
        			extraRep[name] = value
        			local extra_msg2 = string.format(SR_REP_MSG3, name, value, pIndex, extraChange) --新加可以显示巅峰等级
					--PlaySoundFile("Interface\\AddOns\\!HeXie\\Gold.ogg", "Master")		
        			createMessage(extra_msg2);
        		end
    		end
    	elseif name and (not isHeader) or (hasRep) then
        	if not rep[name] then
        		rep[name] = barValue;
      		end
    		local change = barValue - rep[name];
    		if (change > 0) then
        		rep[name] = barValue
        		local msg = string.format(SR_REP_MSG, name, barValue - barMin, barMax - barMin, change)
        		createMessage(msg)
      		end
    	end
	end
end
function createMessage(msg)
	local info = ChatTypeInfo["COMBAT_FACTION_CHANGE"];
	for j = 1, 4, 1 do
    	local chatfrm = getglobal("ChatFrame"..j);
    	for k,v in pairs(chatfrm.messageTypeList) do
      		if v == "COMBAT_FACTION_CHANGE" then
        		chatfrm:AddMessage(msg, info.r, info.g, info.b, info.id);
        		break;
    		end
    	end
  	end
end
function initExtraRep(factionID, name)
    ReputationFrame.paragonFramesPool:ReleaseAll()
	local currentValue, threshold, _, hasRewardPending = C_Reputation.GetFactionParagonInfo(factionID);
		if not extraRep[name] then
			extraRep[name] = currentValue % threshold
			if hasRewardPending then
    			extraRep[name] = extraRep[name] + threshold
    		end
		end
	if extraRep[name] > threshold and (not hasRewardPending) then
    	extraRep[name] = extraRep[name] - threshold
	end
end
local fmm = CreateFrame("Frame");
fmm:RegisterEvent("UPDATE_FACTION");
fmm:SetScript("OnEvent", SR_Update);
ChatFrame_AddMessageEventFilter("CHAT_MSG_COMBAT_FACTION_CHANGE", function() return true; end);

local NUM_FACTIONS_DISPLAYED = NUM_FACTIONS_DISPLAYED
local REPUTATION_PROGRESS_FORMAT = REPUTATION_PROGRESS_FORMAT
local C_Reputation_IsFactionParagon = C_Reputation.IsFactionParagon
local C_Reputation_GetFactionParagonInfo = C_Reputation.GetFactionParagonInfo
hooksecurefunc("ReputationFrame_Update", function(self, elapsed)
	ReputationFrame.paragonFramesPool:ReleaseAll()
	local numFactions = GetNumFactions()
	for n=1,NUM_FACTIONS_DISPLAYED, 1 do
		local factionIndex = ReputationListScrollFrame.offset+n
		local factionRow = _G["ReputationBar"..n]
		local factionBar = _G["ReputationBar"..n.."ReputationBar"]
		local factionStanding = _G["ReputationBar"..n.."ReputationBarFactionStanding"]
		if factionIndex <= numFactions then
			local name,_,_,_,_,_,_,_,_,_,_,_,_,factionID = GetFactionInfo(factionIndex)
			if factionID and C_Reputation_IsFactionParagon(factionID) then
				local currentValue,threshold,rewardQuestID,hasRewardPending = C_Reputation_GetFactionParagonInfo(factionID)
				factionRow.name = name
				factionRow.questID = rewardQuestID
				factionRow.count = floor(currentValue/threshold)
				local count = factionRow.count
				if currentValue then
					local value = currentValue - count*10000
				    if hasRewardPending then count = count-1 end
					if hasRewardPending then
						local paragonFrame = ReputationFrame.paragonFramesPool:Acquire()
						paragonFrame.factionID = factionID
						paragonFrame:SetPoint("RIGHT",factionRow,11,0)
						paragonFrame.Glow:SetShown(true)
						paragonFrame.Check:SetShown(true)
						paragonFrame:Show()
						value = value+threshold
					end
					factionBar:SetMinMaxValues(0,threshold)
					factionBar:SetValue(value)
					factionRow.rolloverText = format(REPUTATION_PROGRESS_FORMAT,BreakUpLargeNumbers(value),BreakUpLargeNumbers(threshold))
						factionStanding:SetText(" "..BreakUpLargeNumbers(value).."/".."巅峰("..count..")")
						factionRow.standingText = (" "..BreakUpLargeNumbers(value).."/".."巅峰("..count..")")
						factionRow.rolloverText = nil					
					if factionIndex == GetSelectedFaction() and ReputationDetailFrame:IsShown() then
						if count > 0 then
							ReputationDetailFactionName:SetText(name.."\n|cff00ff00(已开"..count.."个巅峰箱子)|r")
						end
					end
				end
			else
			    factionRow.name = nil
				factionRow.count = nil
				factionRow.questID = nil
			end
		else
			factionRow:Hide()
		end
	end
end)]]--
local SR_REP_MSG1 = "%s(%d/%d)：%+d声望";
local SR_REP_MSG2 = "%s(%d/%d)：%d声望";
local SR_REP_MSG3 = "%s(%d/巅峰%d)：%+d声望";  
local SR_REP_MSG4 = "%s(%d/巅峰%d)：%+d声望，已满请兑换！"; 
local rep = {};
local extraRep = {};
local C_Reputation_IsFactionParagon = C_Reputation.IsFactionParagon
local fa = {
[2472] = true, --档案员卷宗(有等级6/6)
}
local fb = {
[2432] = true, --威·娜莉(有等级6/6)    
}
local fc = {
[2464] = true, --法夜-魅夜王庭(仙野舞台剧场)(有等级5/5) 
[2462] = true, --通灵-缝合大师(有等级5/5)              
}

local function SR_Update(self)
	local numFactions = GetNumFactions();
	for i = 1, numFactions, 1 do
		local name, _, standingID, barMin, barMax, barValue, atWarWith, canToggleAtWar, isHeader, isCollapsed, hasRep, isWatched, isChild, factionID = GetFactionInfo(i);
		local value = 0;
        if not fa[factionID] then
			if barValue >= 42000 then
		    	local hasParagon = C_Reputation_IsFactionParagon(factionID)
            	if hasParagon then
                	initExtraRep(factionID,name)
                	local currentValue, threshold, rQuestID, hasRewardPending = C_Reputation.GetFactionParagonInfo(factionID)
					local pIndex = floor(currentValue/threshold) --新加可以显示巅峰等级
                	value = currentValue % threshold
                	if hasRewardPending then 
                    	value = value + threshold
                	end
                	local extraChange = value-extraRep[name]
                	local cot = floor(currentValue/threshold)
                	local val = currentValue-threshold*(cot-1)
                	local ext = threshold+extraChange
                	if extraChange ~= 0 then
                    	if extraChange > 0 and value < 10000 then
                        	extraRep[name] = value
                        	--local extra_msg = string.format(SR_REP_MSG3, name, value, extraChange)
							local extra_msg = string.format(SR_REP_MSG3, name, value, pIndex, extraChange) --新加可以显示巅峰等级
                        	createMessage(extra_msg)
                    	elseif extraChange > 0 and value > 10000 then
                        	extraRep[name] = value
							local extra_msg = string.format(SR_REP_MSG4, name, value, pIndex, extraChange) --新加可以显示巅峰等级
                        	--local extra_msg = string.format(SR_REP_MSG4, name, value, extraChange)
		                	--PlaySoundFile("Interface\\AddOns\\!HeXie\\Gold.ogg", "Master")	
                        	createMessage(extra_msg)
				    	else
                        	extraRep[name] = val
							local extra_msg = string.format(SR_REP_MSG4, name, val, pIndex, ext) --新加可以显示巅峰等级
                        	--local extra_msg = string.format(SR_REP_MSG4, name, val, ext)
		                	--PlaySoundFile("Interface\\AddOns\\!HeXie\\Gold.ogg", "Master")
                        	createMessage(extra_msg)
                    	end
                	end	
            	end
            elseif name and (not isHeader) or (hasRep) then
                if not rep[name] then
                    rep[name] = barValue;
                end
                local change = barValue - rep[name];
                if (change > 0) and (not fb[factionID]) and (not fc[factionID]) then
                    rep[name] = barValue
                    local msg = string.format(SR_REP_MSG1, name, barValue - barMin, barMax - barMin, change)
                    createMessage(msg)
				elseif (change > 0) and (not fb[factionID]) and fc[factionID] then
                    rep[name] = barValue
                    local msg = string.format(SR_REP_MSG1.."(等级"..standingID.."/5)", name, barValue - barMin, barMax - barMin, change)
                    createMessage(msg)
				elseif (change > 0) and (not fc[factionID]) and fb[factionID] then
                    rep[name] = barValue
                    local msg = string.format(SR_REP_MSG1.."(等级"..standingID.."/6)", name, barValue - barMin, barMax - barMin, change)
                    createMessage(msg)
			    elseif (change < 0) then
			        rep[name] = barValue
        		    local msg = string.format(SR_REP_MSG2, name, barValue - barMin, barMax - barMin, change)
        		    createMessage(msg)
                end
            end
		end
        if fa[factionID] then
			if barValue >= 41000 then
		    	local hasParagon = C_Reputation_IsFactionParagon(factionID)
            	if hasParagon then
                	initExtraRep(factionID,name)
                	local currentValue, threshold, rQuestID, hasRewardPending = C_Reputation.GetFactionParagonInfo(factionID)
					local pIndex = floor(currentValue/threshold) --新加可以显示巅峰等级
                	value = currentValue % threshold
                	if hasRewardPending then 
                    	value = value + threshold
                	end
                	local extraChange = value-extraRep[name]
                	local cot = floor(currentValue/threshold)
                	local val = currentValue-threshold*(cot-1)
                	local ext = threshold+extraChange
                	if extraChange ~= 0 then
                    	if extraChange > 0 and value < 10000 then
                        	extraRep[name] = value
                        	--local extra_msg = string.format(SR_REP_MSG3, name, value, extraChange)
							local extra_msg = string.format(SR_REP_MSG3, name, value, pIndex, extraChange) --新加可以显示巅峰等级
                        	createMessage(extra_msg)
                    	elseif extraChange > 0 and value > 10000 then
                        	extraRep[name] = value
							local extra_msg = string.format(SR_REP_MSG4, name, value, pIndex, extraChange) --新加可以显示巅峰等级
                        	--local extra_msg = string.format(SR_REP_MSG4, name, value, extraChange)
		                	--PlaySoundFile("Interface\\AddOns\\!HeXie\\Gold.ogg", "Master")
                        	createMessage(extra_msg)
				    	else
                        	extraRep[name] = val
							local extra_msg = string.format(SR_REP_MSG4, name, val, pIndex, ext) --新加可以显示巅峰等级
                        	--local extra_msg = string.format(SR_REP_MSG4, name, val, ext)
		                	--PlaySoundFile("Interface\\AddOns\\!HeXie\\Gold.ogg", "Master")
                        	createMessage(extra_msg)
                    	end
                	end	
            	end
        	elseif name and (not isHeader) or (hasRep) then
            	if not rep[name] then
                	rep[name] = barValue;
            	end
            	local change = barValue - rep[name];
            	if (change > 0) then
                	rep[name] = barValue
                	local msg = string.format(SR_REP_MSG1.."(等级"..standingID.."/6)", name, barValue - barMin, barMax - barMin, change)
                	createMessage(msg)
				elseif (change < 0) then
			    	rep[name] = barValue
        			local msg = string.format(SR_REP_MSG2, name, barValue - barMin, barMax - barMin, change)
        			createMessage(msg)
            	end
        	end
		end
	end
end
function createMessage(msg)
	local info = ChatTypeInfo["COMBAT_FACTION_CHANGE"];
	for j = 1, 4, 1 do
    	local chatfrm = getglobal("ChatFrame"..j);
    	for k,v in pairs(chatfrm.messageTypeList) do
      		if v == "COMBAT_FACTION_CHANGE" then
        		chatfrm:AddMessage(msg, info.r, info.g, info.b, info.id);
        		break;
    		end
    	end
  	end
end
function initExtraRep(factionID, name)
    ReputationFrame.paragonFramesPool:ReleaseAll()
	local currentValue, threshold, _, hasRewardPending = C_Reputation.GetFactionParagonInfo(factionID);
		if not extraRep[name] then
			extraRep[name] = currentValue % threshold
			if hasRewardPending then
    			extraRep[name] = extraRep[name] + threshold
    		end
		end
	if extraRep[name] > threshold and (not hasRewardPending) then
    	extraRep[name] = extraRep[name] - threshold
	end
end
local fmm = CreateFrame("Frame");
fmm:RegisterEvent("UPDATE_FACTION");
fmm:SetScript("OnEvent", SR_Update);
ChatFrame_AddMessageEventFilter("CHAT_MSG_COMBAT_FACTION_CHANGE", function() return true; end);

local NUM_FACTIONS_DISPLAYED = NUM_FACTIONS_DISPLAYED
local REPUTATION_PROGRESS_FORMAT = REPUTATION_PROGRESS_FORMAT
local C_Reputation_IsFactionsParagon = C_Reputation.IsFactionParagon
local C_Reputation_GetFactionParagonInfo = C_Reputation.GetFactionParagonInfo
hooksecurefunc("ReputationFrame_Update", function(self, elapsed)
	ReputationFrame.paragonFramesPool:ReleaseAll()
	local numFactions = GetNumFactions()
	for n=1,NUM_FACTIONS_DISPLAYED, 1 do
		local factionIndex = ReputationListScrollFrame.offset+n
		local factionRow = _G["ReputationBar"..n]
		local factionBar = _G["ReputationBar"..n.."ReputationBar"]
		local factionStanding = _G["ReputationBar"..n.."ReputationBarFactionStanding"]
		if factionIndex <= numFactions then
			local name,_,_,_,_,_,_,_,_,_,_,_,_,factionID = GetFactionInfo(factionIndex)
			if factionID and C_Reputation_IsFactionsParagon(factionID) then
				local currentValue,threshold,rewardQuestID,hasRewardPending = C_Reputation_GetFactionParagonInfo(factionID)
				factionRow.name = name
				factionRow.questID = rewardQuestID
				factionRow.count = floor(currentValue/threshold)
				local count = factionRow.count
				if currentValue then
					local value = currentValue - count*10000
				    if hasRewardPending then count = count-1 end
					if hasRewardPending then
						local paragonFrame = ReputationFrame.paragonFramesPool:Acquire()
						paragonFrame.factionID = factionID
						paragonFrame:SetPoint("RIGHT",factionRow,11,0)
						paragonFrame.Glow:SetShown(true)
						paragonFrame.Check:SetShown(true)
						paragonFrame:Show()
						value = value+threshold
					end
					factionBar:SetMinMaxValues(0,threshold)
					factionBar:SetValue(value)
					factionRow.rolloverText = format(REPUTATION_PROGRESS_FORMAT,BreakUpLargeNumbers(value),BreakUpLargeNumbers(threshold))
						factionStanding:SetText(" "..BreakUpLargeNumbers(value).."/".."巅峰("..count..")")
						factionRow.standingText = (" "..BreakUpLargeNumbers(value).."/".."巅峰("..count..")")
						factionRow.rolloverText = nil					
					if factionIndex == GetSelectedFaction() and ReputationDetailFrame:IsShown() then
						if count > 0 then
							ReputationDetailFactionName:SetText(name.."\n|cff00ff00(已开"..count.."个巅峰箱子)|r")
						end
					end
				end
			else
			    factionRow.name = nil
				factionRow.count = nil
				factionRow.questID = nil
			end
		else
			factionRow:Hide()
		end
	end
end)
---------------------------------
---自动加载--障礙物後、視野外的名條透名度，預設0.4、隔著牆、柱子後面、樓上樓下等等
---------------------------------
local function defaultcvar()
    --在這裡寫入配置
    SetCVar("nameplateOccludedAlphaMult", 0.1)  
end
--這是載入條件
local frame = CreateFrame("FRAME", "defaultcvar")
    frame:RegisterEvent("PLAYER_ENTERING_WORLD")
        local function eventHandler(self, event, ...)
           defaultcvar()
end
frame:SetScript("OnEvent", eventHandler)

--------------------
-------硬汉化-----
--------------------
--LOCALE_zhCN and "放大选定的姓名板" or "放大選定的姓名板"